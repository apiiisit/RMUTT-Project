<div class="m-2 w-full">
    <p-fieldset legend="จัดการบัณฑิต">
        <p-toolbar styleClass="mb-4 gap-2">
            <ng-template pTemplate="left">
                <!-- <button pButton pRipple label="เพิ่ม" icon="pi pi-plus" class="p-button-success mr-2"
                    (click)="openStdDialog()"></button> -->
                <button pButton pRipple icon="pi pi-trash" class="p-button-danger"
                    [disabled]="!selectedStd || !selectedStd.length" (click)="deleteStds()"></button>
            </ng-template>

            <ng-template pTemplate="center">

                <a href="/download/student-template.csv" class="no-underline">
                    <p-button label="ตัวอย่างไฟล์" icon="pi pi-file" styleClass="mr-2" ></p-button>
                </a>

                <input #fileUpload type="file" (click)="fileUpload.value = null!" style="display:none"
                    (change)="readFile($event)"
                    accept=".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel">
                <button pButton pRipple label="Import" icon="pi pi-file-import" (click)="fileUpload.click()"></button>
            </ng-template>
        </p-toolbar>

        <p-table #dt [columns]="selectedColumns" [value]="stdList" responsiveLayout="stack" [rows]="10"
            [paginator]="true" [globalFilterFields]="['id', 'name', 'faculty']" [(selection)]="selectedStd"
            [rowHover]="true" dataKey="id"
            currentPageReportTemplate="แสดง {first} ถึง {last} จากทั้งหมด {totalRecords} รายการ"
            [showCurrentPageReport]="true">

            <ng-template pTemplate="caption">
                <div class="flex align-items-center justify-content-between">
                    <p-multiSelect [options]="cols" [(ngModel)]="selectedColumns" optionLabel="header"
                        selectedItemsLabel="{0} คอลัมน์ที่เลือก" placeholder="เลือกคอลัมน์"></p-multiSelect>

                    <span class="p-input-icon-left">
                        <i class="pi pi-search"></i>
                        <input pInputText type="text" (input)="searchStd(dt, $event)"
                            placeholder="ค้นหา... ชื่อ,รหัส,สาขา" />
                    </span>
                </div>
            </ng-template>

            <ng-template pTemplate="header" let-columns>
                <tr>
                    <th style="width: 4rem">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                    </th>
                    <th style="width: 4rem" pSortableColumn="row">ลำดับ <p-sortIcon field="row"></p-sortIcon></th>
                    <th style="width: 12rem" pSortableColumn="degree">ปริญญา <p-sortIcon field="degree"></p-sortIcon>
                    </th>
                    <th style="width: 10rem" pSortableColumn="id">รหัสนักศึกษา <p-sortIcon field="id"></p-sortIcon></th>
                    <th style="width: 10rem" pSortableColumn="name">ชื่อ-สกุล <p-sortIcon field="name"></p-sortIcon>
                    </th>
                    <th style="width: 10rem" pSortableColumn="faculty">สาขา <p-sortIcon field="faculty"></p-sortIcon>
                    </th>
                    <th pSortableColumn="year">ปี/ภาค <p-sortIcon field="year"></p-sortIcon></th>

                    <th *ngFor="let col of columns">
                        {{col.header}}
                    </th>

                    <!-- <th></th> -->
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-std let-columns="columns">
                <tr>
                    <td>
                        <p-tableCheckbox [value]="std"></p-tableCheckbox>
                    </td>
                    <td class="text-right">
                        <span class="p-column-title">ลำดับ</span>
                        <span>{{std.rowfaculty}}</span>
                    </td>
                    <td>
                        <span class="p-column-title">ปริญญา</span>
                        <span>{{std.degree}} {{std.honor}}</span>
                    </td>
                    <td>
                        <span class="p-column-title">รหัสนักศึกษา</span>
                        <span>{{std.id}}</span>
                    </td>
                    <td>
                        <span class="p-column-title">ชื่อ-สกุล</span>
                        <span>
                            {{std.prefixname}} {{std.name}}
                            <span *ngIf="std.award" class="font-bold">
                                (เหรียญ{{std.award}})
                            </span>
                        </span>
                    </td>
                    <td>
                        <span class="p-column-title">สาขา</span>
                        <span>{{std.faculty}}</span>
                    </td>
                    <td>
                        <span class="p-column-title">ปี/ภาค</span>
                        <span>{{std.year}}</span>
                    </td>

                    <td *ngFor="let col of columns">
                        <span class="p-column-title">{{col.header}}</span>

                        <p-image *ngIf="col.field === 'photo'" src="api/image/{{std[col.field]}}" [alt]="std.name"
                            width="50" [preview]="true" (onImageError)="imageService.defaultImage($event)"></p-image>

                        <!-- <p-image *ngIf="col.field === 'atk'" src="api/image/{{std.atk}}" alt="atk" width="50"
                            [preview]="true" (onImageError)="imageService.defaultImage($event, 'atk')"></p-image> -->

                        <img *ngIf="col.field === 'tag'" src="assets/images/rfid-{{std.tag ? 'green' : 'red'}}.png"
                            alt="rfid" width="50" style="cursor: pointer" routerLink="/admin/manage/rfid/{{std.id}}" />
                    </td>

                    <!-- <td>
                        <button pButton pRipple icon="pi pi-pencil" class="p-button-rounded p-button-success mr-2"
                            style="height: 2.5rem; width: 2.5rem;" (click)="editStd(std)"></button>
                        <button pButton pRipple icon="pi pi-trash" class="p-button-rounded p-button-danger"
                            style="height: 2.5rem; width: 2.5rem;" (click)="deleteStd(std)"></button>
                    </td> -->
                </tr>
            </ng-template>

            <ng-template pTemplate="summary">
                <div class="flex align-items-center justify-content-between">
                    มีบัณฑิตทั้งหมด {{stdList ? stdList.length : 0 }} คน
                </div>
            </ng-template>

        </p-table>
    </p-fieldset>
</div>

<app-import-std-dialog [readStd]="readStd" />
<!-- <app-std-dialog /> -->